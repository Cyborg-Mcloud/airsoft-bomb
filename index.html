<!DOCTYPE html>
<html>
<meta http-equiv="Content-Security-Policy" content="img-src * 'self' data:; default-src *; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval'">

<meta name="viewport"   content="width=device-width, initial-scale=1.0, user-scalable=no">
  <head>

  	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Airsoft Counter-Strike Bomb</title>

	<script type="text/javascript" charset="utf-8" src="cordova.js"></script>

	<script type="text/javascript" charset="utf-8" src="io.js"></script>
<script type="text/javascript" charset="utf-8" src="func.js"></script>
	

<script type="text/javascript" charset="utf-8">

var mystatus=0;

document.addEventListener("deviceready", onDeviceReady, false);

var myid=0;

var started;
started=0;

function onBackKeyDown() 
	{

	}

function onMenuDown() 
	{
	}


function onSearchDown() 
	{
	}

function onVolumeDown()
	{
	}

function onVolumeUp()
	{
	}


var mousex;
var mousey;
var omousex;
var omousey;
	
var sx;
var sy;

var canacX;
var canacY;
var inpause=0;

sx=getscreenw();
sy=getscreenh();
var myself=0;


var gamehttp;
if (window.XMLHttpRequest) {gamehttp=new XMLHttpRequest();}
else if (window.ActiveXObject) {gamehttp=new ActiveXObject('Microsoft.XMLHTTP');}
else {alert('Your browser does not support XMLHTTP!');}
gamehttp.onreadystatechange=update_data;




var cache_ignore=0;
var cache_ignore_wifi=1;

// ------------------------------
function onDeviceReady() 
	{

	console.log("device ready, checking connection");
	checkConnection();

	document.addEventListener("pause", onPause, false);
	//document.addEventListener("backbutton", onBackKeyDown, false);
	//document.addEventListener("menubutton", onMenuDown, false);
	//document.addEventListener("searchbutton", onSearchDown, false);
	//document.addEventListener("volumedownbutton", onVolumeDown, false);
	//document.addEventListener("volumeupbutton", onVolumeUp, false);

	
	console.log("device ready, dealing with record file");
	
//	kc=checkIfFileExists("locdata.txt");

	//if (started==0)	
	//	{
	//	Start();
	//	}
	//setmypos();
	}
// ------------------------

function MainProg()
	{
	console.log("main prog: "+started);

	setTimeout("MainProg();",1000);
	}



function update_data()
	{		
	if(gamehttp.readyState == 4)
		{
		mr=gamehttp.responseText;
		if (mr!="")
			{
			console.log("data received from server: "+mr);

			url="http://design.ge/geotaxi/chat.php?req=1&myid="+myid;
		
			console.log("request chat: "+url);
			gamehttp.open('GET',url,true);
			gamehttp.send(null);
			}
		}
	}


function Start()
	{
	console.log("Start / END");
	if (started==0)
		{started=1;  MainProg();}  // document.getElementById('mainb').innerHTML="STOP";
	else
		{//started=0;
		} //  document.getElementById('mainb').innerHTML="START";

	}

function onPause()
	{
	console.log("on pause");
	if (mystatus==0 || mystatus==5)
		{
		started=0;
		clearWatch();
		WriteData();
		inpause=1;
		}

	}

function onResume() 
	{
	console.log("on resume");
	if (inpause==1)
		{
		inpause=0;
		}

	if (started==0)
		{
		checkConnection();
		Start();
		}
	}


function onSuccess(position) 
	{
	console.log("GPS on success");


	if (started==0)	{Start();}

	
    }

   

function stopScrolling( touchEvent )
			{ touchEvent.preventDefault(); }



function mdown(event)
	{


	}

function mup(event)
	{
	console.log("mouse up");


	}


var myw=Math.floor(sx/256)+2;
var myh=Math.floor(sy/256)+2;

if (myw/2==Math.floor(myw/2))
	{myw++;}

if (myh/2==Math.floor(myh/2))
	{myh++;}



document.getElementById("fanjara").style.width=sx+"px";
document.getElementById("fanjara").style.height=sy+"px";


var mywpx=(myw-1)*256;
var myhpx=(myh-1)*256;


canacX=(-(mywpx-(sx))/2);
canacY=(-(myhpx-(sy))/2);

console.log(" x: "+(-(mywpx-(sx))/2)+ " Y: "+(-(myhpx-(sy))/2));




 function fail(error) 
	{
    console.log(error.code);
    }
 
    </script>
  </head>
  <style>
	body {color:white; margin:0px; padding:0px;}
	a {text-decoration:none; color:white;}
  </style>
  <body bgcolor=#e3b202>

<div id='fanjara' style='position:relative; overflow:hidden; width:400px; height:600px;'>
		
	<div  style='position:fixed; left:0px; top:0px; width:100%; height:50px; background-color:white; z-index:211; ' >
	
	</div>
		<!-- MAIN MAP -->
	<div id='mouser' name='mouser' style='position:fixed; left:0px; top:50px; width:355px; height:500px; z-index:250;  ' ontouchstart="mdown(event);" ontouchend="mup(event);"  ontouchmove="getmousecoord(event);" ></div>


</div>
</body>
</html>
